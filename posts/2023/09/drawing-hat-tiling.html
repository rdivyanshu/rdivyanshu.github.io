<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2023-09-20" />
  <meta name="description" content="Hats! Hats! Substitution tiling in
racket" />
  <title>Drawing hat tiling using Racket</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #ffffff;
        color: #a0a0a0;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
    div.sourceCode
      { color: #1f1c1b;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #1f1c1b; } /* Normal */
    code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
    code span.an { color: #ca60ca; } /* Annotation */
    code span.at { color: #0057ae; } /* Attribute */
    code span.bn { color: #b08000; } /* BaseN */
    code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
    code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #924c9d; } /* Char */
    code span.cn { color: #aa5500; } /* Constant */
    code span.co { color: #898887; } /* Comment */
    code span.cv { color: #0095ff; } /* CommentVar */
    code span.do { color: #607880; } /* Documentation */
    code span.dt { color: #0057ae; } /* DataType */
    code span.dv { color: #1f1c1b; } /* DecVal */
    code span.er { color: #bf0303; text-decoration: underline; } /* Error */
    code span.ex { color: #4379a0; font-weight: bold; } /* Extension */
    code span.fl { color: #b08000; } /* Float */
    code span.fu { color: #644a9b; } /* Function */
    code span.im { color: #ff5500; } /* Import */
    code span.in { color: #b08000; } /* Information */
    code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
    code span.op { color: #1f1c1b; } /* Operator */
    code span.ot { color: #1d2482; } /* Other */
    code span.pp { color: #006e28; } /* Preprocessor */
    code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #ff5500; } /* SpecialString */
    code span.st { color: #bf0303; } /* String */
    code span.va { color: #1f1c1b; } /* Variable */
    code span.vs { color: #bf0303; } /* VerbatimString */
    code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../../style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p> <a href="../../../index.html"> ↫ Home </a> </p>
<header id="title-block-header">
<h1 class="title">Drawing hat tiling using Racket</h1>
</header>
<h3 id="introduction">Introduction</h3>
<p><em>Note: This blogpost is heavily inspired from <a
href="https://community.wolfram.com/groups/-/m/t/2858759">this wolfram
community article</a></em>.</p>
<p>Whether a single geometrical shape exists that can tile plane
aperiodically was open problem until recently. Since discovery of hat
and related shapes we know answer is affirmative. In this blog we will
draw tiling of plane using hat and its reflection. Hat is a ploykite
with <code>13</code> components, <code>3</code> different edge lengths
and interior angles multiples of <code>30</code> degree. Using metapict
library, let’s draw canonical hat and its reflection.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode racket"><code class="sourceCode racket"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#lang racket</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">require</span> metapict<span class="op">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> H-edge <span class="op">(</span>turn<span class="op">)</span> #:transparent<span class="op">)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> T1 H-edge <span class="op">()</span>  #:transparent<span class="op">)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> T2 H-edge <span class="op">()</span>  #:transparent<span class="op">)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> T3 H-edge <span class="op">()</span>  #:transparent<span class="op">)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> hat</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>T1 -<span class="dv">1</span><span class="op">)</span> <span class="op">(</span>T1 <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">4</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">6</span><span class="op">)</span> <span class="op">(</span>T1 <span class="dv">3</span><span class="op">)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>T1 <span class="dv">5</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">8</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">6</span><span class="op">)</span> <span class="op">(</span>T1 <span class="dv">9</span><span class="op">)</span> <span class="op">(</span>T1 <span class="dv">7</span><span class="op">)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>T2 <span class="dv">10</span><span class="op">)</span> <span class="op">(</span>T3 <span class="dv">12</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">14</span><span class="op">)))</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> flipped-hat</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>T2 -<span class="dv">2</span><span class="op">)</span> <span class="op">(</span>T3 <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">2</span><span class="op">)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>T1 <span class="dv">5</span><span class="op">)</span> <span class="op">(</span>T1 <span class="dv">3</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">6</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">4</span><span class="op">)</span> <span class="op">(</span>T1 <span class="dv">7</span><span class="op">)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>T1 <span class="dv">9</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">6</span><span class="op">)</span> <span class="op">(</span>T2 <span class="dv">8</span><span class="op">)</span> <span class="op">(</span>T1 <span class="dv">11</span><span class="op">)</span> <span class="op">(</span>T1 <span class="dv">1</span><span class="op">)))</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>H-edge-length e<span class="op">)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">cond</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>T1? e<span class="op">)</span>  <span class="op">(</span><span class="kw">sqrt</span> <span class="dv">12</span><span class="op">)]</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>T2? e<span class="op">)</span>         <span class="dv">2</span><span class="op">]</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>T3? e<span class="op">)</span>         <span class="dv">4</span><span class="op">]))</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>scan init fn lst<span class="op">)</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">if</span> <span class="op">(</span><span class="kw">null?</span> lst<span class="op">)</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span><span class="kw">list</span> init<span class="op">)</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="op">(</span><span class="kw">cons</span> init</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">(</span>scan <span class="op">(</span>fn init <span class="op">(</span>first lst<span class="op">))</span> fn <span class="op">(</span>rest lst<span class="op">)))))</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>H-edges-&gt;curve origo turn edges<span class="op">)</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">let</span> <span class="op">([</span>points <span class="op">(</span>scan origo pt+</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                      <span class="op">(</span><span class="kw">map</span> <span class="op">(</span><span class="kw">lambda</span> <span class="op">(</span>e<span class="op">)</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                             <span class="op">(</span>pt@d <span class="op">(</span>H-edge-length e<span class="op">)</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">(*</span> <span class="dv">30</span> <span class="op">(+</span> turn <span class="op">(</span>H-edge-turn e<span class="op">)))))</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                           edges<span class="op">))])</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="kw">apply</span> make-curve <span class="op">(</span><span class="kw">append</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                       <span class="op">(</span><span class="kw">apply</span> <span class="kw">append</span> <span class="op">(</span><span class="kw">map</span> <span class="op">(</span><span class="kw">lambda</span> <span class="op">(</span>p<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> p --<span class="op">))</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                                          <span class="op">(</span>drop-right points <span class="dv">1</span><span class="op">)))</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                       <span class="op">(</span><span class="kw">list</span> cycle<span class="op">)))))</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>with-window <span class="op">(</span>window -<span class="dv">7</span> <span class="dv">7</span> -<span class="dv">7</span> <span class="dv">7</span><span class="op">)</span> <span class="op">(</span>draw <span class="op">(</span>H-edges-&gt;curve <span class="op">(</span>pt <span class="dv">0</span> <span class="dv">0</span><span class="op">)</span> <span class="dv">0</span> hat<span class="op">)))</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>with-window <span class="op">(</span>window -<span class="dv">7</span> <span class="dv">7</span> -<span class="dv">7</span> <span class="dv">7</span><span class="op">)</span> <span class="op">(</span>draw <span class="op">(</span>H-edges-&gt;curve <span class="op">(</span>pt <span class="dv">0</span> <span class="dv">0</span><span class="op">)</span> <span class="dv">0</span> flipped-hat<span class="op">)))</span></span></code></pre></div>
<p>When above code is run, it will draw shapes shown below minus grid
and interior being colored blue.</p>
<p><img src="../../../img/hat.png" /></p>
<h3 id="substitution-tiling">Substitution Tiling</h3>
<p>Larger and larger area of plane can be tiled using <a
href="https://en.wikipedia.org/wiki/Substitution_tiling">substitution
tiling</a>. In case of hat tiling, substitution is given in terms of
metatiles <code>H</code>, <code>T</code>, <code>P</code> and
<code>F</code>. Let’s look at them and code used to draw them.</p>
<p><img src="../../../img/metatile.png" /></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode racket"><code class="sourceCode racket"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> M-edge <span class="op">(</span>turn<span class="op">)</span> #:transparent<span class="op">)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> X+ M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> X- M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> A+ M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> A- M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> B+ M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> B- M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> F+ M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> F- M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span>  L M-edge <span class="op">()</span> #:transparent<span class="op">)</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> meta-H</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>B- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>B- <span class="dv">3</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>X+ <span class="dv">4</span><span class="op">)</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>A+ <span class="dv">5</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">5</span><span class="op">)))</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> meta-T</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>A- <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>A- <span class="dv">2</span><span class="op">)</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>B+ <span class="dv">4</span><span class="op">)))</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> meta-P</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>A- <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span> L <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">2</span><span class="op">)</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>X+ <span class="dv">3</span><span class="op">)</span> <span class="op">(</span>B+ <span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span> L <span class="dv">5</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">5</span><span class="op">)))</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> meta-F</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>L <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">0</span><span class="op">)</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>F+ <span class="dv">1</span><span class="op">)</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>F- <span class="dv">2</span><span class="op">)</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>X+ <span class="dv">3</span><span class="op">)</span> <span class="op">(</span>B+ <span class="dv">3</span><span class="op">)</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span> L <span class="dv">5</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">5</span><span class="op">)))</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>M-edge-length e<span class="op">)</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">cond</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span><span class="kw">or</span> <span class="op">(</span>A+? e<span class="op">)</span> <span class="op">(</span>A-? e<span class="op">)</span> <span class="op">(</span>B+? e<span class="op">)</span> <span class="op">(</span>B-? e<span class="op">))</span> <span class="dv">12</span><span class="op">]</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="kw">else</span> <span class="dv">4</span><span class="op">]))</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>M-edges-&gt;curve origo turn edges<span class="op">)</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">let</span> <span class="op">([</span>points <span class="op">(</span>scan origo pt+</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>                      <span class="op">(</span><span class="kw">map</span> <span class="op">(</span><span class="kw">lambda</span> <span class="op">(</span>e<span class="op">)</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>                             <span class="op">(</span>pt@d <span class="op">(</span>M-edge-length e<span class="op">)</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>                                   <span class="op">(*</span> <span class="dv">60</span> <span class="op">(+</span> turn <span class="op">(</span>M-edge-turn e<span class="op">)))))</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>                           edges<span class="op">))])</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="kw">apply</span> make-curve <span class="op">(</span><span class="kw">append</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>                       <span class="op">(</span><span class="kw">apply</span> <span class="kw">append</span> <span class="op">(</span><span class="kw">map</span> <span class="op">(</span><span class="kw">lambda</span> <span class="op">(</span>p<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> p --<span class="op">))</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>                                          <span class="op">(</span>drop-right points <span class="dv">1</span><span class="op">)))</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>                       <span class="op">(</span><span class="kw">list</span> cycle<span class="op">)))))</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>with-window <span class="op">(</span>window -<span class="dv">20</span> <span class="dv">20</span> -<span class="dv">20</span> <span class="dv">20</span><span class="op">)</span> <span class="op">(</span>draw <span class="op">(</span>M-edges-&gt;curve <span class="op">(</span>pt <span class="dv">0</span> <span class="dv">0</span><span class="op">)</span> <span class="dv">0</span> meta-H<span class="op">)))</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>with-window <span class="op">(</span>window -<span class="dv">20</span> <span class="dv">20</span> -<span class="dv">20</span> <span class="dv">20</span><span class="op">)</span> <span class="op">(</span>draw <span class="op">(</span>M-edges-&gt;curve <span class="op">(</span>pt <span class="dv">0</span> <span class="dv">0</span><span class="op">)</span> <span class="dv">0</span> meta-T<span class="op">)))</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>with-window <span class="op">(</span>window -<span class="dv">20</span> <span class="dv">20</span> -<span class="dv">20</span> <span class="dv">20</span><span class="op">)</span> <span class="op">(</span>draw <span class="op">(</span>M-edges-&gt;curve <span class="op">(</span>pt <span class="dv">0</span> <span class="dv">0</span><span class="op">)</span> <span class="dv">0</span> meta-P<span class="op">)))</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="op">(</span>with-window <span class="op">(</span>window -<span class="dv">20</span> <span class="dv">20</span> -<span class="dv">20</span> <span class="dv">20</span><span class="op">)</span> <span class="op">(</span>draw <span class="op">(</span>M-edges-&gt;curve <span class="op">(</span>pt <span class="dv">0</span> <span class="dv">0</span><span class="op">)</span> <span class="dv">0</span> meta-F<span class="op">)))</span></span></code></pre></div>
<p>Notice that there is mismatch in number between edges in picture and
code. Also there are two variants, positive and negative, of edge types
(<code>X+</code>, <code>X-</code> etc) except <code>L</code>. Why such
oddities will be clear when one looks how hats are projected into these
metatiles.</p>
<p><img src="../../../img/projection-hat.png" /></p>
<p>Edges of metatiles are deconstructed into parts and type and
attribute (positive or negative) are given to them. Positive or negative
label depends on whether parts of hats are bulging out or deflating in
around metatile edges. Substitution rule should line up <code>A+</code>
and <code>A-</code>, <code>B+</code> and <code>B-</code>,
<code>X+</code> and <code>X-</code> so on. This is required so that no
gap remains in tiling. Next let’s look at substitution rules of metatile
<code>H</code>, <code>T</code>, <code>P</code> and <code>F</code>
respectively.</p>
<p><img src="../../../img/extend-metatile.png" /></p>
<p>Since projection of hats in metatiles is not invariant under rotation
but <code>3</code> metatiles are, substitution rule should also specify
orientation of metatiles. In our case this orientation is specified by
local origin of metatile.</p>
<p>Up until now all our drawing is done at origin <code>(pt 0 0)</code>
without rotation even though our methods <code>H-edges-&gt;curve</code>
and <code>M-edges-&gt;curve</code> can account for translation and
rotation. To expand metatiles using substitution rule we will require
translation and rotation. We wrap our canonical drawing of metatiles in
<code>p-meta</code> structure which includes rotation <code>turn</code>
and translation <code>dist</code>. Translation is not given as single
vector but list of vectors each of which is given in terms of metatile
edges <code>M-edge</code>. Idea is if we travel along these edges from
origin we arrive at point which is local origin of wrapped metatile.
Also notice that attributes (<code>+</code> / <code>-</code>) of
<code>M-edge</code> does n’t matter in translation vector as
<code>+</code> and <code>-</code> of same type are always lined up.
Replacing <code>X+</code> with <code>X-</code> (or any other such
pairing) or vice versa makes no difference.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode racket"><code class="sourceCode racket"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="kw">struct</span> p-meta</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>meta turn dist<span class="op">)</span> #:transparent<span class="op">)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> meta-H~&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>p-meta meta-H  <span class="dv">0</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>B+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)))</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-H -<span class="dv">2</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>B+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)))</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-H  <span class="dv">0</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>B- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)))</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-T  <span class="dv">0</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>B+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                                <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)))</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-F -<span class="dv">1</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">3</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>L <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">2</span><span class="op">)))</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-F  <span class="dv">1</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>B- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                                <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>L <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">0</span><span class="op">)))</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-F  <span class="dv">3</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>B+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                                <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>B- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                                <span class="op">(</span>L <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">2</span><span class="op">)))</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-P  <span class="dv">2</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>B+ <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)))</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-P  <span class="dv">1</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>L <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">0</span><span class="op">)))</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>p-meta meta-P  <span class="dv">3</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>B- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                                <span class="op">(</span>X+ <span class="dv">0</span><span class="op">)</span> <span class="op">(</span>B- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">1</span><span class="op">)</span> <span class="op">(</span>X+ <span class="dv">2</span><span class="op">)</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                                <span class="op">(</span>L <span class="dv">2</span><span class="op">)</span> <span class="op">(</span>X- <span class="dv">2</span><span class="op">)))))</span></span></code></pre></div>
<p>Picture below shows how translation of <code>H</code> metatiles are
calculated using <code>M-edges</code>. Notice that first and second
<code>H</code> metatile has same local origin. Second <code>H</code>
metatile (bottom one) is rotated by <code>120</code> degree clockwise
(<code>-2 * 60</code>).</p>
<p><img src="../../../img/H-origin.png" /></p>
<p>We now need to write <code>substitute-many</code> so that we can call
it successively to get bigger and bigger substitution. To achieve this
we need substitution rules for <code>M-edges</code> for fixing
<code>dist</code> which is given by <code>M-edge-reps</code>.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode racket"><code class="sourceCode racket"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>M-edge-reps e<span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">let</span> <span class="op">([</span>turn <span class="op">(</span>M-edge-turn e<span class="op">)])</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="kw">cond</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>A-? e<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>B- turn<span class="op">)</span> <span class="op">(</span>X- turn<span class="op">)</span> <span class="op">(</span>X+ <span class="op">(+</span> turn <span class="dv">1</span><span class="op">)))]</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>A+? e<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>X- <span class="op">(+</span> turn <span class="dv">1</span><span class="op">))</span> <span class="op">(</span>X+ turn<span class="op">)</span> <span class="op">(</span>B+ turn<span class="op">))]</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>B-? e<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>X- <span class="op">(+</span> turn <span class="dv">1</span><span class="op">))</span> <span class="op">(</span>X+ turn<span class="op">)</span> <span class="op">(</span>A- turn<span class="op">))]</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>B+? e<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>A+ turn<span class="op">)</span> <span class="op">(</span>X- turn<span class="op">)</span> <span class="op">(</span>X+ <span class="op">(+</span>  turn <span class="dv">1</span><span class="op">)))]</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>F-? e<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>X+ turn<span class="op">)</span> <span class="op">(</span>L turn<span class="op">)</span> <span class="op">(</span>X- turn<span class="op">)</span> <span class="op">(</span>F+ <span class="op">(+</span> turn <span class="dv">1</span><span class="op">)))]</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>F+? e<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="op">(+</span> turn <span class="dv">1</span><span class="op">))</span> <span class="op">(</span>X+ turn<span class="op">)</span> <span class="op">(</span>L turn<span class="op">)</span> <span class="op">(</span>X- turn<span class="op">))]</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>L? e<span class="op">)</span>  <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>L <span class="op">(-</span> turn <span class="dv">1</span><span class="op">)))]</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>X-? e<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>X- <span class="op">(-</span> turn <span class="dv">1</span><span class="op">))</span> <span class="op">(</span>X+ turn<span class="op">)</span> <span class="op">(</span>L turn<span class="op">)</span> <span class="op">(</span>X- turn<span class="op">)</span> <span class="op">(</span>F+ <span class="op">(+</span> turn <span class="dv">1</span><span class="op">)))]</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>     <span class="op">[(</span>X+? e<span class="op">)</span> <span class="op">(</span><span class="kw">list</span> <span class="op">(</span>F- <span class="op">(+</span> turn <span class="dv">1</span><span class="op">))</span> <span class="op">(</span>X+ turn<span class="op">)</span> <span class="op">(</span>L turn<span class="op">)</span> <span class="op">(</span>X- turn<span class="op">)</span> <span class="op">(</span>X+ <span class="op">(-</span> turn <span class="dv">1</span><span class="op">)))])))</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>turn-M-edge e t<span class="op">)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">cond</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>A-? e<span class="op">)</span> <span class="op">(</span>A- <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>A+? e<span class="op">)</span> <span class="op">(</span>A+ <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>B-? e<span class="op">)</span> <span class="op">(</span>B- <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>B+? e<span class="op">)</span> <span class="op">(</span>B+ <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>F-? e<span class="op">)</span> <span class="op">(</span>F- <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>F+? e<span class="op">)</span> <span class="op">(</span>F+ <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span> L? e<span class="op">)</span> <span class="op">(</span> L <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>X-? e<span class="op">)</span> <span class="op">(</span>X- <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">[(</span>X+? e<span class="op">)</span> <span class="op">(</span>X+ <span class="op">(+</span> t <span class="op">(</span>M-edge-turn e<span class="op">)))]))</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>substitute pm<span class="op">)</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">let</span> <span class="op">([</span>o-turn     <span class="op">(</span>p-meta-turn pm<span class="op">)]</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>o-dist     <span class="op">(</span>p-meta-dist pm<span class="op">)]</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>o-meta     <span class="op">(</span>p-meta-meta pm<span class="op">)])</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="kw">map</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>     <span class="op">(</span><span class="kw">lambda</span> <span class="op">(</span>p<span class="op">)</span> <span class="op">(</span>struct-copy p-meta p</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                              <span class="op">[</span>turn <span class="op">(+</span> o-turn <span class="op">(</span>p-meta-turn p<span class="op">))]</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>                              <span class="op">[</span>dist <span class="op">(</span><span class="kw">append</span> <span class="op">(</span><span class="kw">apply</span> <span class="kw">append</span> <span class="op">(</span><span class="kw">map</span> M-edge-reps o-dist<span class="op">))</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>                                            <span class="op">(</span><span class="kw">map</span> <span class="op">(</span><span class="kw">lambda</span> <span class="op">(</span>e<span class="op">)</span> <span class="op">(</span>turn-M-edge e o-turn<span class="op">))</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                                                 <span class="op">(</span>p-meta-dist p<span class="op">)))]))</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>     <span class="op">(</span><span class="kw">cond</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>       <span class="op">[(</span><span class="kw">eq?</span> o-meta meta-H<span class="op">)</span> meta-H~&gt;<span class="op">]</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>       <span class="op">[(</span><span class="kw">eq?</span> o-meta meta-T<span class="op">)</span> meta-T~&gt;<span class="op">]</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>       <span class="op">[(</span><span class="kw">eq?</span> o-meta meta-P<span class="op">)</span> meta-P~&gt;<span class="op">]</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>       <span class="op">[(</span><span class="kw">eq?</span> o-meta meta-F<span class="op">)</span> meta-F~&gt;<span class="op">]))))</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="ex">define</span><span class="fu"> </span><span class="op">(</span>substitute-many p-metatiles<span class="op">)</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="kw">apply</span> <span class="kw">append</span> <span class="op">(</span><span class="kw">map</span> substitute p-metatiles<span class="op">)))</span></span></code></pre></div>
<p>We have all machinery ready for hat tiling. Code is listed <a
href="https://gist.github.com/rdivyanshu/2d71e604917aa4893a701ca7f71c67b4">here</a>
which also includes functions to project hats into metatiles, which is
not covered here.</p>
<p><img src="../../../img/Hat-tiling.png" /></p>
</body>
</html>
