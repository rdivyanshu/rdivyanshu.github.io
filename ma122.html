<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Solving a mathematic problem using Rosette</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="styling.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="solving-a-mathematic-problem-using-rosette-solver-aided-programming-environment">Solving a mathematic problem using Rosette, solver aided programming environment</h1>
<p>This blogpost is illustration of solver aided programming environment in <a href="https://docs.racket-lang.org/rosette-guide/index.html">rosette</a> by way of solving crux mathematic problem. Rosette is environment where programming is assisted with SMT solver. This let us do <a href="https://docs.racket-lang.org/rosette-guide/ch_essentials.html#%28part._sec~3averify%29">verification</a>, <a href="https://docs.racket-lang.org/rosette-guide/ch_essentials.html#%28part._sec~3asynthesize%29">synthesis</a>, and <a href="https://docs.racket-lang.org/rosette-guide/ch_essentials.html#%28part._sec~3asolve%29">angelic execution</a>.</p>
<p>First the problem we are planning to tackle.</p>
<p><a href="https://cms.math.ca/wp-content/uploads/2021/06/CRUXv47n5-b.pdf">MA122</a></p>
<p>Four people Mr Baker, Ms Carpenter, Mr Driver, and Ms Plumber are employed for four jobs as a baker, carpenter, driver, and plumber. None of them has a name identifying their occupation. They make four statements:</p>
<ol type="1">
<li>Mr Baker says he is the plumber.</li>
<li>Mr Driver says he is the baker.</li>
<li>Ms Carpenter says she is not the plumber.</li>
<li>Ms Plumber says she is not the carpenter.</li>
</ol>
<p>Exactly ? (coffee stain) of the four statements are true. Who is the driver? (One of the editors apologizes for spilling coffee on the page, but we are sure the question used to have a unique answer!)</p>
<p>Rosette is a language implemented in racket which supports racket constructs plus additional solver aided forms. We begin with giving language directive to racket then proceeds with imports.</p>
<pre><code>#lang rosette
(require rosette/lib/angelic)</code></pre>
<p>It would be helpful if we define a name for all professions mentioned in the puzzle.</p>
<pre><code>(define professions (list &#39;baker &#39;carpenter &#39;driver &#39;plumber))</code></pre>
<p>Next we introduce assignment of profession to person with help of rosette construct <code>choose*</code>. We will using variable names for persons and symbols for professions. Here we are saying each person is assigned one of professions without assigning any concrete value. Actual assignment will be done by SMT solver considering all the constraints at hand.</p>
<pre><code>(define baker (apply choose* profession))
(define carpenter (apply choose* profession))
(define driver (apply choose* profession))
(define plumber (apply choose* profession))</code></pre>
<p>Let us list down constraints (fixed) which always hold. Each person has different profession and person name don’t collide with profession name.</p>
<pre><code>(define (f-constraints)
  (list (distinct? baker driver carpenter plumber)
        (not (equal? baker &#39;baker))
        (not (equal? driver &#39;driver))
        (not (equal? carpenter &#39;carpenter))
        (not (equal? plumber &#39;plumber))))</code></pre>
<p>Further note down constraints (variable) which may or may not hold as some statements might be false.</p>
<pre><code>(define (v-constraints)
  (list (equal? baker &#39;plumber)
        (equal? driver &#39;baker)
        (! (equal? carpenter &#39;plumber))
        (! (equal? plumber &#39;carpenter))))</code></pre>
<p>We need helper method to find who is assigned given profession in solution. Let’s write that down too.</p>
<pre><code>(define (assigned profession sol)
  (first (filter (lambda (p) (equal? (evaluate p sol) profession))
          (list baker carpenter driver plumber))))</code></pre>
<p>We are now at crux of our small program where we write function to fix assignment of person (variable) to profession (symbol) with help of SMT solver using rosette solver aided form <a href="https://docs.racket-lang.org/rosette-guide/ch_syntactic-forms_rosette.html#%28def._%28%28lib._rosette%2Fquery%2Fform..rkt%29._solve%2B%29%29">solve+</a>. First we find assignment with constraint given as parameter. If no assignment exists due constraints being too restricting we return empty list else we try to find another solution where <code>driver</code> profession is not assigned to same person as first solution. If such assignment exists we return these two solutions in list otherwise we return first solution in list.</p>
<pre><code>(define (m-solve constraint)
  (define s-solve (solve+))
  (let ([sol (s-solve constraint)])
    (if (sat? sol)
        (letrec ([a-driver (assigned &#39;driver sol)]
                 [n-sol (s-solve (not (equal? &#39;driver a-driver)))])
            (cons sol (if (sat? n-sol) (list n-sol) (list))))
        (list))))</code></pre>
<p>Finally let us solve the puzzle. We iterate through 0 to 4 assuming it is true variable constraints count which is anded with fixed constraints then asking for solution using <code>m-solve</code>. If only one solution exists we have found what we are looking for. Once we find that solution we ask profession assigned to each person. As you can see answer to our little puzzle is <code>baker</code>.</p>
<pre><code>(define a-solutions 
    (filter (lambda (s) (= (length s) 1))
            (for/list ([t (range 5)])
                (m-solve (and (apply &amp;&amp; (f-constraints))
                              (= t (length (filter identity (v-constraints)))))))))

(length a-solutions)
(define sol (first (first a-solutions)))
(evaluate (list baker carpenter driver plumber) sol)</code></pre>
<pre><code>Welcome to DrRacket, version 8.0 [cs].
Language: rosette, with debugging; memory limit: 128 MB.
1
&#39;(driver plumber carpenter baker)
&gt; </code></pre>
<p>Complete source code can be found <a href="https://gist.github.com/rdivyanshu/41635e6d9075eac29e677dbfb025f18f">here</a>.</p>
</body>
</html>
